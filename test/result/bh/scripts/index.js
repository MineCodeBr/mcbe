import*as o from"@minecraft/server";import*as t from"@minecraft/server-ui";var e={},l=function(o){return"".concat(o.location.x,"/").concat(o.location.y,"/").concat(o.location.z)},c=function(o){return[o.north(),o.south(),o.west(),o.east(),o.above(),o.below()]},n=function(t,e){return t.setPermutation(o.BlockPermutation.resolve(t.getItemStack().typeId,function(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},l=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(e).filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),l.forEach(function(t){var l;l=e[t],t in o?Object.defineProperty(o,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[t]=l})}return o}({},t.permutation.getAllStates(),e)))};o.world.beforeEvents.worldInitialize.subscribe(function(i){try{i.blockComponentRegistry.registerCustomComponent("control:onPlayerDestroy",{onPlayerDestroy:function(t){try{o.world.setDynamicProperty("control/".concat(l(t.block))),e={}}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("control:onPlace",{onPlace:function(t){try{o.world.setDynamicProperty("control/".concat(l(t.block)),l(t.block))}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("link_cable:onPlayerInteract",{onPlayerInteract:function(o){}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("link_cable:onPlayerDestroy",{onPlayerDestroy:function(o){try{e={}}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("link_cable:onPlace",{onPlace:function(t){try{!function(t){var i=["minecraft:chest"],d=["mc:simple_cable","mc:link_cable","mc:terminal","mc:control"],r=["mc:simple_cable","mc:link_cable"];n(t.block,{"mc:n":d.includes(null===(y=t.block.north())||void 0===y?void 0:null===(m=y.getItemStack())||void 0===m?void 0:m.typeId)||i.includes(null===(k=t.block.north())||void 0===k?void 0:null===(s=k.getItemStack())||void 0===s?void 0:s.typeId),"mc:s":d.includes(null===(p=t.block.south())||void 0===p?void 0:null===(b=p.getItemStack())||void 0===b?void 0:b.typeId)||i.includes(null===(g=t.block.south())||void 0===g?void 0:null===(I=g.getItemStack())||void 0===I?void 0:I.typeId),"mc:w":d.includes(null===(h=t.block.west())||void 0===h?void 0:null===(f=h.getItemStack())||void 0===f?void 0:f.typeId)||i.includes(null===(w=t.block.west())||void 0===w?void 0:null===(S=w.getItemStack())||void 0===S?void 0:S.typeId),"mc:e":d.includes(null===(P=t.block.east())||void 0===P?void 0:null===(C=P.getItemStack())||void 0===C?void 0:C.typeId)||i.includes(null===(D=t.block.east())||void 0===D?void 0:null===(_=D.getItemStack())||void 0===_?void 0:_.typeId),"mc:u":d.includes(null===(x=t.block.above())||void 0===x?void 0:null===(R=x.getItemStack())||void 0===R?void 0:R.typeId)||i.includes(null===(z=t.block.above())||void 0===z?void 0:null===(O=z.getItemStack())||void 0===O?void 0:O.typeId),"mc:d":d.includes(null===(T=t.block.below())||void 0===T?void 0:null===(N=T.getItemStack())||void 0===N?void 0:N.typeId)||i.includes(null===(A=t.block.below())||void 0===A?void 0:null===(j=A.getItemStack())||void 0===j?void 0:j.typeId),"mc:n_con":i.includes(null===(E=t.block.north())||void 0===E?void 0:null===(B=E.getItemStack())||void 0===B?void 0:B.typeId),"mc:s_con":i.includes(null===(F=t.block.south())||void 0===F?void 0:null===(L=F.getItemStack())||void 0===L?void 0:L.typeId),"mc:w_con":i.includes(null===(G=t.block.west())||void 0===G?void 0:null===(q=G.getItemStack())||void 0===q?void 0:q.typeId),"mc:e_con":i.includes(null===(J=t.block.east())||void 0===J?void 0:null===(H=J.getItemStack())||void 0===H?void 0:H.typeId),"mc:u_con":i.includes(null===(M=t.block.above())||void 0===M?void 0:null===(K=M.getItemStack())||void 0===K?void 0:K.typeId),"mc:d_con":i.includes(null===(U=t.block.above(-1))||void 0===U?void 0:null===(Q=U.getItemStack())||void 0===Q?void 0:Q.typeId)});var a=!0,v=!1,u=void 0;try{for(var m,y,s,k,b,p,I,g,f,h,S,w,C,P,_,D,R,x,O,z,N,T,j,A,B,E,L,F,q,G,H,J,K,M,Q,U,V,W=c(t.block)[Symbol.iterator]();!(a=(V=W.next()).done);a=!0){var X,Y,Z=V.value;(null===(X=Z.getItemStack())||void 0===X?void 0:X.typeId)==="mc:control"?o.world.getDynamicProperty("control/".concat(l(Z)))&&(e[l(t.block)]=o.world.getDynamicProperty("control/".concat(l(Z)))):r.includes(null===(Y=Z.getItemStack())||void 0===Y?void 0:Y.typeId)&&e[l(Z)]&&(e[l(t.block)]=e[l(Z)])}}catch(o){v=!0,u=o}finally{try{a||null==W.return||W.return()}finally{if(v)throw u}}}(t)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("link_cable:onTick",{onTick:function(t){try{!function(t){var i=["minecraft:chest"],d=["mc:simple_cable","mc:link_cable"],r=["mc:simple_cable","mc:link_cable"];n(t.block,{"mc:n":d.includes(null===(y=t.block.north())||void 0===y?void 0:null===(m=y.getItemStack())||void 0===m?void 0:m.typeId)||i.includes(null===(k=t.block.north())||void 0===k?void 0:null===(s=k.getItemStack())||void 0===s?void 0:s.typeId),"mc:s":d.includes(null===(p=t.block.south())||void 0===p?void 0:null===(b=p.getItemStack())||void 0===b?void 0:b.typeId)||i.includes(null===(g=t.block.south())||void 0===g?void 0:null===(I=g.getItemStack())||void 0===I?void 0:I.typeId),"mc:w":d.includes(null===(h=t.block.west())||void 0===h?void 0:null===(f=h.getItemStack())||void 0===f?void 0:f.typeId)||i.includes(null===(w=t.block.west())||void 0===w?void 0:null===(S=w.getItemStack())||void 0===S?void 0:S.typeId),"mc:e":d.includes(null===(P=t.block.east())||void 0===P?void 0:null===(C=P.getItemStack())||void 0===C?void 0:C.typeId)||i.includes(null===(D=t.block.east())||void 0===D?void 0:null===(_=D.getItemStack())||void 0===_?void 0:_.typeId),"mc:u":d.includes(null===(x=t.block.above())||void 0===x?void 0:null===(R=x.getItemStack())||void 0===R?void 0:R.typeId)||i.includes(null===(z=t.block.above())||void 0===z?void 0:null===(O=z.getItemStack())||void 0===O?void 0:O.typeId),"mc:d":d.includes(null===(T=t.block.below())||void 0===T?void 0:null===(N=T.getItemStack())||void 0===N?void 0:N.typeId)||i.includes(null===(A=t.block.below())||void 0===A?void 0:null===(j=A.getItemStack())||void 0===j?void 0:j.typeId),"mc:n_con":i.includes(null===(E=t.block.north())||void 0===E?void 0:null===(B=E.getItemStack())||void 0===B?void 0:B.typeId),"mc:s_con":i.includes(null===(F=t.block.south())||void 0===F?void 0:null===(L=F.getItemStack())||void 0===L?void 0:L.typeId),"mc:w_con":i.includes(null===(G=t.block.west())||void 0===G?void 0:null===(q=G.getItemStack())||void 0===q?void 0:q.typeId),"mc:e_con":i.includes(null===(J=t.block.east())||void 0===J?void 0:null===(H=J.getItemStack())||void 0===H?void 0:H.typeId),"mc:u_con":i.includes(null===(M=t.block.above())||void 0===M?void 0:null===(K=M.getItemStack())||void 0===K?void 0:K.typeId),"mc:d_con":i.includes(null===(U=t.block.above(-1))||void 0===U?void 0:null===(Q=U.getItemStack())||void 0===Q?void 0:Q.typeId)});var a=!0,v=!1,u=void 0;try{for(var m,y,s,k,b,p,I,g,f,h,S,w,C,P,_,D,R,x,O,z,N,T,j,A,B,E,L,F,q,G,H,J,K,M,Q,U,V,W=c(t.block)[Symbol.iterator]();!(a=(V=W.next()).done);a=!0){var X,Y,Z,$,oo,ot=V.value;if(e[l(t.block)]){if((null===(Z=ot.getItemStack())||void 0===Z?void 0:Z.typeId)==="minecraft:chest"){if(null===(oo=e[e[l(t.block)]])||void 0===oo?void 0:null===($=oo.chests)||void 0===$?void 0:$.includes(l(ot)))return;e[e[l(t.block)]]?e[e[l(t.block)]].chests.push(l(ot)):e[e[l(t.block)]]={chests:[l(ot)]}}}else(null===(X=ot.getItemStack())||void 0===X?void 0:X.typeId)==="mc:control"?o.world.getDynamicProperty("control/".concat(l(ot)))&&(e[l(t.block)]=o.world.getDynamicProperty("control/".concat(l(ot)))):r.includes(null===(Y=ot.getItemStack())||void 0===Y?void 0:Y.typeId)&&e[l(ot)]&&(e[l(t.block)]=e[l(ot)])}}catch(o){v=!0,u=o}finally{try{a||null==W.return||W.return()}finally{if(v)throw u}}}(t)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("terminal:onPlace",{onPlace:function(o){try{!function(o){o.block.dimension.runCommandAsync("summon mc:terminal tile.mc:terminal.name ".concat(o.block.location.x," ").concat(o.block.location.y," ").concat(o.block.location.z))}(o)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("terminal:onPlayerDestroy",{onPlayerDestroy:function(o){try{var t;null===(t=o.block.dimension.getEntitiesAtBlockLocation(o.block.location)[0])||void 0===t||t.remove()}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("terminal:onPlayerInteract",{onPlayerInteract:function(o){try{!function(o){var c=new t.ActionFormData().title("ola"),n=!0,i=!1,d=void 0;try{for(var r,a=e[e[l(o.block)]].chests[Symbol.iterator]();!(n=(r=a.next()).done);n=!0)for(var v,u=r.value,m=null===(v=o.block.dimension.getBlock({x:Number(u.split("/")[0]),y:Number(u.split("/")[1]),z:Number(u.split("/")[2])}))||void 0===v?void 0:v.getComponent("minecraft:inventory").container,y=0;y<m.size;y++){var s=m.getItem(y);s&&c.button(s.typeId)}}catch(o){i=!0,d=o}finally{try{n||null==a.return||a.return()}finally{if(i)throw d}}c.show(o.player)}(o)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("terminal:onTick",{onTick:function(t){try{!function(t){var n=null===(u=t.block.dimension.getEntitiesAtBlockLocation(t.block.location)[0])||void 0===u?void 0:null===(v=u.getComponent("minecraft:inventory"))||void 0===v?void 0:v.container,i=["mc:simple_cable","mc:link_cable"],d=!0,r=!1,a=void 0;try{for(var v,u,m,y,s=c(t.block)[Symbol.iterator]();!(d=(y=s.next()).done);d=!0){var k,b,p=y.value;!e[l(t.block)]&&((null===(k=p.getItemStack())||void 0===k?void 0:k.typeId)==="mc:control"?o.world.getDynamicProperty("control/".concat(l(p)))&&(e[l(t.block)]=o.world.getDynamicProperty("control/".concat(l(p)))):i.includes(null===(b=p.getItemStack())||void 0===b?void 0:b.typeId)&&e[l(p)]&&(e[l(t.block)]=e[l(p)]))}}catch(o){r=!0,a=o}finally{try{d||null==s.return||s.return()}finally{if(r)throw a}}if(null===(m=e[e[l(null==t?void 0:t.block)]])||void 0===m?void 0:m.chests){var I=!0,g=!1,f=void 0;try{for(var h,S=e[e[l(t.block)]].chests[Symbol.iterator]();!(I=(h=S.next()).done);I=!0)for(var w,C=h.value,P=null===(w=t.block.dimension.getBlock({x:Number(C.split("/")[0]),y:Number(C.split("/")[1]),z:Number(C.split("/")[2])}))||void 0===w?void 0:w.getComponent("minecraft:inventory").container,_=0;_<P.size;_++){var D=P.getItem(_);D&&(null==n||n.setItem(_,D))}}catch(o){g=!0,f=o}finally{try{I||null==S.return||S.return()}finally{if(g)throw f}}}}(t)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("simple_cable:onPlayerDestroy",{onPlayerDestroy:function(o){try{e={}}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("simple_cable:onPlayerInteract",{onPlayerInteract:function(t){try{!function(t){var e;if(null===(e=t.player)||void 0===e?void 0:e.isSneaking)return o.world.clearDynamicProperties();o.world.getDynamicPropertyIds().forEach(function(t){o.world.getDynamicProperty(t)})}(t)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("simple_cable:onPlace",{onPlace:function(t){try{!function(t){var i=["mc:simple_cable","mc:link_cable","mc:terminal","mc:control"];n(t.block,{"mc:n":i.includes(null===(u=t.block.north())||void 0===u?void 0:null===(v=u.getItemStack())||void 0===v?void 0:v.typeId),"mc:s":i.includes(null===(y=t.block.south())||void 0===y?void 0:null===(m=y.getItemStack())||void 0===m?void 0:m.typeId),"mc:w":i.includes(null===(k=t.block.west())||void 0===k?void 0:null===(s=k.getItemStack())||void 0===s?void 0:s.typeId),"mc:e":i.includes(null===(p=t.block.east())||void 0===p?void 0:null===(b=p.getItemStack())||void 0===b?void 0:b.typeId),"mc:u":i.includes(null===(g=t.block.above())||void 0===g?void 0:null===(I=g.getItemStack())||void 0===I?void 0:I.typeId),"mc:d":i.includes(null===(h=t.block.below())||void 0===h?void 0:null===(f=h.getItemStack())||void 0===f?void 0:f.typeId)});var d=!0,r=!1,a=void 0;try{for(var v,u,m,y,s,k,b,p,I,g,f,h,S,w=c(t.block)[Symbol.iterator]();!(d=(S=w.next()).done);d=!0){var C,P,_=S.value;(null===(C=_.getItemStack())||void 0===C?void 0:C.typeId)==="mc:control"?o.world.getDynamicProperty("control/".concat(l(_)))&&(e[l(t.block)]=o.world.getDynamicProperty("control/".concat(l(_)))):(null===(P=_.getItemStack())||void 0===P?void 0:P.typeId)==="mc:simple_cable"&&e[l(_)]&&(e[l(t.block)]=e[l(_)])}}catch(o){r=!0,a=o}finally{try{d||null==w.return||w.return()}finally{if(r)throw a}}}(t)}catch(o){}}})}catch(o){}try{i.blockComponentRegistry.registerCustomComponent("simple_cable:onTick",{onTick:function(t){try{!function(t){var i=["mc:simple_cable","mc:link_cable","mc:terminal","mc:control"],d=["mc:simple_cable","mc:link_cable"];n(t.block,{"mc:n":i.includes(null===(m=t.block.north())||void 0===m?void 0:null===(u=m.getItemStack())||void 0===u?void 0:u.typeId),"mc:s":i.includes(null===(s=t.block.south())||void 0===s?void 0:null===(y=s.getItemStack())||void 0===y?void 0:y.typeId),"mc:w":i.includes(null===(b=t.block.west())||void 0===b?void 0:null===(k=b.getItemStack())||void 0===k?void 0:k.typeId),"mc:e":i.includes(null===(I=t.block.east())||void 0===I?void 0:null===(p=I.getItemStack())||void 0===p?void 0:p.typeId),"mc:u":i.includes(null===(f=t.block.above())||void 0===f?void 0:null===(g=f.getItemStack())||void 0===g?void 0:g.typeId),"mc:d":i.includes(null===(S=t.block.below())||void 0===S?void 0:null===(h=S.getItemStack())||void 0===h?void 0:h.typeId)});var r=!0,a=!1,v=void 0;try{for(var u,m,y,s,k,b,p,I,g,f,h,S,w,C=c(t.block)[Symbol.iterator]();!(r=(w=C.next()).done);r=!0){var P,_,D=w.value;if(e[l(t.block)])return;(null===(P=D.getItemStack())||void 0===P?void 0:P.typeId)==="mc:control"?o.world.getDynamicProperty("control/".concat(l(D)))&&(e[l(t.block)]=o.world.getDynamicProperty("control/".concat(l(D)))):d.includes(null===(_=D.getItemStack())||void 0===_?void 0:_.typeId)&&e[l(D)]&&(e[l(t.block)]=e[l(D)])}}catch(o){a=!0,v=o}finally{try{r||null==C.return||C.return()}finally{if(a)throw v}}}(t)}catch(o){}}})}catch(o){}});